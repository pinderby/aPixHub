define(["jquery","globals","backbone","underscore","js-cookie"],function(e,i,t,s,n){var a=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},o=function(e){var i=e.trim(),t=i.match(/[a-zA-Z]+/);return null!=t&&i===t[0]},r=t.View.extend({className:"modal fade",insertErrorMessage:function(e,i){this.$("."+e).addClass("has-error"),this.$("."+e+" .help-block").html(i)},insertGenericErrorMessage:function(e){this.$(".error").html("<div class='alert alert-danger fade in'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+e+"</div>"),this.$(".error .alert").delay(1e3).slideUp(200,function(){this.$(".error .alert").alert("close")}.bind(this))}}),l=r.extend({initialize:function(e){this.switchView=!1,this.template=e.LoginModalTemplate},events:{"click .btn-login":"nativeLogin","click .btn-primary-fb":"fbLogin","click .signupModal":"onSignupClicked"},onSignupClicked:function(){this.switchView=!0},open:function(){this.render(),this.$el.modal("show")},render:function(){this.$el.html(this.template()),this.$el.on("hide.bs.modal",function(e){this.switchView?setTimeout(function(){this.switchView=!1}.bind(this),1):this.model.onModalClose()}.bind(this)),this.$("input").keypress(this.onKeyPress.bind(this))},onKeyPress:function(e){13==e.keyCode&&this.nativeLogin()},fbLogin:function(){this.model.signInFacebook(),i.loginModel.addOneSignInCallback(this.onLogin.bind(this)),i.loginModel.addOneSignInFailCallback(function(){this.$el.modal("hide")}.bind(this))},nativeLogin:function(){this.$(".form-group").removeClass("has-error"),this.$(".form-group .help-block").html("");var e=this.$("input[name=login_username]").val(),t=this.$("input[name=login_password]").val();e&&t?a(e)?(this.model.signInNative(e,t),i.loginModel.addOneSignInCallback(this.onLogin.bind(this)),i.loginModel.addOneSignInFailCallback(this.onFailedLogin.bind(this))):this.insertErrorMessage("username","Invalid username"):e?this.insertErrorMessage("password","Please enter a password"):this.insertErrorMessage("username","Please enter an username")},onLogin:function(){this.$("#login_username").val(""),this.$("#login_password").val(""),this.$el.modal("hide")},onFailedLogin:function(e){this.insertGenericErrorMessage(e.errorMessage)}}),h=r.extend({initialize:function(e){this.switchView=!1,this.recaptchaKey=null,this.template=e.SignupModalTemplate,i.RecaptchaDeferred.done(this.onRecaptchaLoad.bind(this))},events:{"click .btn-signup":"signup","click .loginModal":"onLoginClicked"},render:function(){this.$el.html(this.template()),this.$el.on("hide.bs.modal",function(e){this.switchView?setTimeout(function(){this.switchView=!1}.bind(this),1):this.model.onModalClose()}.bind(this)),this.$("input").keypress(this.onKeyPress.bind(this)),this.$el.on("show.bs.modal",function(e){this.$(".recaptchaBlock").length>0&&this.$(".recaptchaBlock").children().length>0?grecaptcha.reset(this.recaptchaKey):this.$(".recaptchaBlock").length>0&&(this.recaptchaKey=grecaptcha.render("recaptchaSignupBlock",{sitekey:"6Lcobh0TAAAAAN1K9rWeJ8xgl8uYkASWSDLBuKU1",theme:"light",callback:this.onRecaptchaSuccess.bind(this)}))}.bind(this))},onRecaptchaSuccess:function(e){this.$(".btn-signup").removeClass("disabled")},onRecaptchaLoad:function(){this.render()},open:function(){this.render()},onKeyPress:function(e){13==e.keyCode&&this.signup(e)},onLoginClicked:function(){this.switchView=!0},signup:function(e){if(!this.$("btn-signup").hasClass("disabled")){this.$(".form-group").removeClass("has-error"),this.$(".form-group .help-block").html("");var t=this.$("input[name=register_first_name]").val(),s=this.$("input[name=register_last_name]").val(),n=this.$("input[name=register_email]").val(),r=this.$("input[name=register_password]").val();t&&s&&n&&r?a(n)?o(t)?o(s)?r.length<4?this.insertErrorMessage("email","The password must be at least 4 characters."):(this.model.registerNative(t,s,n,r),i.loginModel.addOneSignInCallback(this.onSignup.bind(this)),i.loginModel.addOneSignInFailCallback(this.onFailedSignup.bind(this))):this.insertErrorMessage("last_name","This is not an acceptable name"):this.insertErrorMessage("first_name","This is not an acceptable name"):this.insertErrorMessage("email","That is not a valid email address."):t?s?n?r||this.insertErrorMessage("password","Please enter password"):this.insertErrorMessage("email","Please enter email"):this.insertErrorMessage("last_name","Please enter last name"):this.insertErrorMessage("first_name","Please enter first name")}},onSignup:function(){this.$("#register_first_name").val(""),this.$("#register_last_name").val(""),this.$("#register_email").val(""),this.$("#register_password").val(""),this.$el.modal("hide")},onFailedSignup:function(e){this.insertGenericErrorMessage(e.errorMessage)}}),d=r.extend({initialize:function(e){this.initialState=!0,this.errorMessage="",this.template=e.PasswordModalTemplate},onResetPassword:function(){e.ajax({type:"POST",url:i.PrivateApiFrontendHost+"/api/private/v1.0/user/forgotPassword",data:{email:this.$("#forgot_email_address").val()}}).done(function(e){e.hasOwnProperty("errorMessage")||0==e.length?this.errorMessage=e.errorMessage:(this.initialState=!1,this.render())}.bind(this))},render:function(){this.$el.html(this.template({initialState:this.initialState,errorMessage:this.errorMessage})),this.$el.on("hide.bs.modal",function(){this.initialState=!0}.bind(this)),this.errorMessage="",this.$(".btn-submit").click(this.onResetPassword.bind(this))}}),c=t.View.extend({baseInitialize:function(e){this.template=e.template,this.model.isLoggedIn()||this.resetSignInPromise()},logout:function(){this.model.signOut(),this.onSignout()},resetSignInPromise:function(){i.loginModel.addOneSignInCallback(function(){this.onSignin()}.bind(this)),i.loginModel.addOneSignInFailCallback(function(){setTimeout(function(){this.resetSignInPromise()}.bind(this),1)}.bind(this))},onSignout:function(){this.render(),this.resetSignInPromise()},onSignin:function(){this.render(),this.model.addOneSignOutCallback(function(){this.onSignout()}.bind(this))},render:function(){if(this.model.isLoggedIn()){var e=this.model.user.toJSON();e.loggedIn=!0,this.$el.html(this.template(e)),this.$(".logout").click(this.logout.bind(this))}else this.$el.html(this.template({loggedIn:!1}))}}),g=c.extend({initialize:function(e){e.template=e.PageHeaderLoginMobileTemplate,this.baseInitialize(e)}});return{LoginModal:l,SignupModal:h,PasswordModal:d,DesktopLoginArea:c.extend({initialize:function(e){e.template=e.PageHeaderLoginTemplate,this.baseInitialize(e)}}),MobileLoginArea:g}});
//# sourceMappingURL=LoginView.min.js.map